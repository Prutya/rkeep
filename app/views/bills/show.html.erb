<% provide :page_title, "Bill #{@bill.id}" %>
<% provide :page_heading do %>
  <%= "Bill #{@bill.id}" %>
  <strong class="label label-<%= bill_bootstrap_status(@bill.status) %>"><%= @bill.status %></strong>
<% end %>

<menu class="col-xs-12 action-bar">
  <div class="text-left col-xs-12 col-md-4 action-bar-section">
    <%= link_to shift_url(@bill.shift), class: 'btn btn-default' do %>
      <%= icon('list') %> <%= 'Back to shift' %>
    <% end %>
  </div>

  <div class="text-right col-xs-12 col-md-8 action-bar-section">
    <% unless @bill.closed? || @bill.cancelled? %>
      <%= link_to edit_shift_bill_url(@bill.shift, @bill), class: 'btn btn-default' do %>
        <%= icon('pencil') %> <%= 'Edit bill' %>
      <% end %>

      <%= link_to new_shift_bill_item_url(@bill.shift, @bill), class: 'btn btn-primary' do %>
        <%= icon('plus') %> <%= 'Add item' %>
      <% end %>

      <%= link_to shift_bill_url(@bill.shift, @bill), class: 'btn btn-success', method: :delete, data: { confirm: 'Are you sure?' } do %>
        <%= icon('check') %> <%= 'Checkout' %>
      <% end %>

      <%= link_to cancel_shift_bill_url(@bill.shift, @bill), class: 'btn btn-warning', method: :delete, data: { confirm: 'Are you sure?' } do %>
        <%= icon('trash') %> <%= 'Cancel' %>
      <% end %>
    <% end %>
  </div>
</menu>

<section class="col-xs-12 col-sm-3">
  <legend class="text-center">Information</legend>

  <div class="row">
    <div class="form-group col-xs-6">
      <%= label :bill, :table %>
      <input type="text" id="bill_table_name" name="bill[table][name]" value="<%= @bill.table.name if @bill.table.present? %>" class="form-control" readonly="readonly" />
    </div>

    <div class="form-group col-xs-6">
      <%= label :bill, :people %>
      <%= text_field :bill, :people_number, class: 'form-control', readonly: true %>
    </div>
  </div>

  <div class="form-group">
    <%= label :bill, :subtotal %>
    <%= text_field :bill, :subtotal, value: '%.2f' % (@bill.subtotal || @bill.calculate_subtotal), class: 'form-control', readonly: true %>
  </div>

  <div class="form-group">
    <%= label :bill, :discount %>
    <input type="text" id="bill_discount_value" name="bill[discount][value]" value="<%= "#{'%.2f' % @bill.discount.value} %" %>" class="form-control" readonly="readonly" />
  </div>

  <div class="form-group">
    <%= label :bill, :total %>
    <%= text_field :bill, :total, value: '%.2f' % (@bill.subtotal || @bill.calculate_total), class: 'form-control', readonly: true %>
  </div>

  <div class="form-group">
    <%= label :bill, :created_at %>
    <%= text_field :bill, :created_at, value: @bill.created_at.strftime("%Y-%m-%d %H:%M"), class: 'form-control', readonly: true %>
  </div>
</section>

<section class="col-xs-12 col-sm-9 table-responsive">
  <legend class="text-center">Items</legend>

  <table class="table">
    <thead>
      <tr>
        <td class="text-right"><%= 'Title' %></td>
        <td class="text-right"><%= 'Price' %></td>
        <td class="text-right"><%= 'Quantity' %></td>
        <td class="text-right"><%= 'Subtotal' %></td>
        <td class="text-right"><%= 'Total' %></td>
        <td class="text-right"><%= 'Actions' %></td>
      </tr>
    </thead>
    <tbody>
      <% @bill.bill_items.each do |item| %>
      <tr>
        <td class="text-right"><%= item.good.name %></td>
        <td class="text-right"><%= '%.2f' % item.good.price %></td>
        <td class="text-right"><%= item.quantity  %></td>
        <td class="text-right"><%= '%.2f' % item.calculate_subtotal %></td>
        <td class="text-right"><%= '%.2f' % item.calculate_total(@bill.discount.value) %></td>
        <td class="text-right">
          <% unless @bill.closed? || @bill.cancelled? %>
            <%= link_to shift_bill_item_url(@bill.shift, @bill, item), class: 'btn btn-xs btn-danger', method: :delete, data: { confirm: 'Are you sure?' } do %>
              <%= icon('trash') %>
            <% end %>
          <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>
</section>
